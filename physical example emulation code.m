clc;     %% 
clear all; %%
close all;   
%%
step = 0.0001; 
n = 400000;    
t = 0:step:step*n; 
%% initial
x1=0.5;
x2=-1;
x3=1;
dot_x1=0;
dot_x2=0;
dot_x3=0;

dot_zeta1 =0;
zeta_2=0;
dot_zeta2=0;
zeta_3=0;
dot_zeta_3=0;
alfa_1=0;
alfa_2=0;
hat_theta_1 = 15;
hat_theta_2 = 25;
hat_theta_3 = 25;
u = 0;
dot_hat_theta_3 = 0;
dot_hat_theta_1 = 0;
dot_hat_theta_2 = 0;

%% param
J = 0.1625;
m = 0.506;
G = 9.8;
Kb = 0.09;
L = 0.5;
L0=0.0305;
M0 = 0.434;
R = 0.0005;
R0 = 0.23;
Kt = 0.9;
B0 = 0.01625;

a1 = J/(Kt);
a2 = (m*(L0^2))/(3*Kt);
a3 = M0*(L0^2)/Kt;
a4 = 2*M0*(L0^2)/(5*Kt);

a5 = m*L0*G/(2*Kt);
a6 = M0*L0*G/Kt;

a7 = J/Kt;
a8 = m*(L0^2)/(3*Kt);
a9 = M0*(L0^2)/Kt;
a10 = 2*M0*(L0^2)/(5*Kt);

b1 = -B0/Kt;
b2 = 1/L;
b3 = -Kb/L;
b4 = -R/L;
gama1 = 1;
gama2 = 1;
gama3 = 1;
sigma1 = 1;
sigma2 = 1;
sigma3 = 1;

k1 = 10;
k2 = 10;
k3 = 60;
T = 5;

eta = 1.5;
chi= 20;
%% neural  network node
b = 1;
hidden1 = 89;

for i=1:1:n
    tt= i*step;
    %% 
        d1 = 0.5*sin((x1).^2)+0.01*cos(0.1*(x1)*tt);
        d2 = 0.02*cos(x2*tt);
        d3 = 0.03*sin(x3*tt);
    %% 
     xd = sin(tt);
    xds(i) = xd;
    dot_xd = cos(tt);
    %% Scalar time-varying function 
	if tt < T
        beta = chi*((T-tt)/T)^3+eta;
        
        dot_beta=-3*chi*(T-tt)^2/(T^3); 
    else 
        beta = eta;
        dot_bata = 0;
    end;
       beta1s(i)=beta;
       beta2s(i)=-beta;
%% error transfer
    e = x1 - xd;
    e1s(i)=e;
    zeta_1 = tan((pi/2)*e/beta);
    P = (1+(tan(pi*e/(2*beta)))^2)*pi/(2*beta);
    dot_e = dot_x1 - dot_xd;
    dot_zeta_1 =P *(x2+d1-(dot_beta/beta)*e);
   
   %% neural networks 1    
      Z1 = [x1;dot_beta;beta;xd];
      dd1 = [-11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 10.25 10.5 10.75 11;
           -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 10.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 10.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 10.25 10.5 10.75 11];
for j = 1:hidden1
    varphi_1(j) = exp(-((norm(Z1-dd1(:,j)))^2)/(2*b^2));
end
Phi_1 = varphi_1*varphi_1' + 1;
%Phi=norm(varphi)^2+1;
    
%% alfa1
alfa_1 = -(1/P)*k1*zeta_1-zeta_1*hat_theta_1*Phi_1;
dot_hat_theta_1 = gama1*P*((zeta_1)^2)*Phi_1-sigma1*hat_theta_1;
A=-(1/P)*k1-hat_theta_1*Phi_1;
B=-2*k1*zeta_1/pi/(1+zeta_1^2);
C=-zeta_1*Phi_1;
dot_alfa_1 = A*dot_zeta_1+B* dot_beta+C*dot_hat_theta_1;
alfa_1s(i) = alfa_1;
e2=x2-alfa_1;
e2s(i)=e2;

%% step2
 zeta_2 = x2-alfa_1;
 f2=-b1*x2/(a1+a2+a3+a4)-(a5+a6)/(a7+a8+a9+a10)*sin(x1);
 dot_zeta_2 = (1/(a1+a2+a3+a4))*(zeta_3+alfa_2) +f2+d2-dot_alfa_1;
  %% neural networks 2    
      Z2 = [x1;x2;dot_zeta_1;dot_beta;dot_hat_theta_1;beta];
      dd2 = [-11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
           -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11];
for j = 1:hidden1
    varphi_2(j) = exp(-((norm(Z2-dd2(:,j)))^2)/(2*b^2));
end
Phi_2 = varphi_2*varphi_2' + 1;
%% alfa2
alfa_2 = -k2*(a1+a2+a3+a4)*zeta_2-(a1+a2+a3+a4)*zeta_2*hat_theta_2*Phi_2-(a1+a2+a3+a4)*P*zeta_2;
dot_hat_theta_2 = gama2*zeta_2^2*Phi_2-sigma2*hat_theta_2;
A=-k2*(a1+a2+a3+a4)-(a1+a2+a3+a4)*hat_theta_2*Phi_2;
B=-(a1+a2+a3+a4)*P;
C=-(a1+a2+a3+a4)*zeta_2*Phi_2;
dot_alfa_2 = A*dot_zeta_2+B* dot_zeta_1+C*dot_hat_theta_2;
alfa_2s(i) = alfa_2;
e3=x3-alfa_2;
e3s(i)=e3;
%% step3
zeta_3 = x3-alfa_2;
f3 = -b3*x2-b4*x3;
dot_zeta_3 = b2*u+f3+d3-dot_alfa_2;
 %% neural networks 3   
      Z3 = [x2;x3;dot_zeta_2;dot_hat_theta_2;dot_zeta_1];
      dd3 = [-11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11;
          -11 -10.75 -10.5 -10.25 -10 -9.75 -9.5 -9.25 -9 -8.75 -8.5 -8.25 -8 -7.75 -7.5 -7.25 -7 -6.75 -6.5 -6.25 -6 -5.75 -5.5 -5.25 -5 -4.75 -4.5 -4.25 -4 -3.75 -3.5 -3.25 -3 -2.75 -2.5 -2.25 -2 -1.75 -1.5 -1.25 -1 -0.75 -0.5 -0.25 0 0.25 0.5 0.75 1 1.25 1.5 1.75 2 2.25 2.5 2.75 3 3.25 3.5 3.75 4 4.25 4.5 4.75 5 5.25 5.5 5.75 6 6.25 6.5 6.75 7 7.25 7.5 7.75 8 8.25 8.5 8.75 9 9.25 9.5  9.75 10 1.25 10.5 10.75 11];
for j = 1:hidden1
    varphi_3(j) = exp(-((norm(Z3-dd3(:,j)))^2)/(2*b^2));
end
Phi_3 = varphi_3*varphi_3' + 1;
%% u
u = -k3/b2*zeta_3-zeta_3*dot_hat_theta_3*Phi_3/b2-zeta_2/b2/(a1+a2+a3+a4);
dot_hat_theta_3 = gama3*zeta_3^2*Phi_3-sigma3*hat_theta_3;
us(i)= u;

dot_x1 = x2+d1;
dot_x2 = 1/(a1+a2+a3+a4)*(x3-(B0/Kt)*x2)-(a5+a6)/(a7+a8+a9+a10)*sin(x1)+d2;
dot_x3 = (1/L)*u-(Kb/L)*x2-(R/L)*x3+d3;
%%  update law
hat_theta1s(i)=hat_theta_1;
hat_theta2s(i)=hat_theta_2;
hat_theta3s(i)=hat_theta_3;
hat_theta_1=hat_theta_1+dot_hat_theta_1*step;
hat_theta_2=hat_theta_2+dot_hat_theta_2*step;
hat_theta_3=hat_theta_3+dot_hat_theta_3*step;
%% 
x1 = x1 + dot_x1*step;
x1s(i) = x1;
x2 = x2 + dot_x2*step;
 x2s(i) = x2;
x3 = x3 + dot_x3*step;
 x3s(i) = x3;
end
figure(1);
plot(t(1:n),e1s,'r',t(1:n),beta1s,'g--',t(1:n),beta2s,'g--','linewidth',2);
legend('e_{1}','boundary curve','boundary curve');
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$e_1$}','Interpreter','latex','FontSize',14);


figure(2);
plot(t(1:n), us,'b','linewidth',1.5);
legend('u_{1}');
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$u_1$}','Interpreter','latex','FontSize',14);


figure(3);
plot(t(1:n), hat_theta1s,'r', 'linewidth',2);
legend({'$\hat\theta_1$'},'Interpreter','latex','FontSize',14)
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$||\hat \theta_1||$}','Interpreter','latex','FontSize',14);


figure(4);
plot(t(1:n), hat_theta2s,'b--', 'linewidth',2);
legend({'$\hat\theta_2$'},'Interpreter','latex','FontSize',14)
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$||\hat \theta_2||$}','Interpreter','latex','FontSize',14);

figure(5);
plot(t(1:n), hat_theta3s,'g', 'linewidth',2);
legend({'$\hat\theta_3$'},'Interpreter','latex','FontSize',14)
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$||\hat \theta_3||$}','Interpreter','latex','FontSize',14);


figure(6);
plot(t(1:n), x1s,'r', t(1:n), x2s,'b--', t(1:n), x3s,'g','linewidth',2);
legend('x_{1}','x_{2}','x_{3}');
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$x_1,x_2,x_3$}','Interpreter','latex','FontSize',14);


figure(7);
plot(t(1:n),x1s,'r',t(1:n),xds,'b--','linewidth',2);
legend('x_{1}','x_{d}');
xlabel('Time(sec)','FontName','Times New Roman','FontSize',14);
ylabel('{$x_1,x_d$}','Interpreter','latex','FontSize',14);


